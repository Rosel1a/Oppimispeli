<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <title>Oppilas tiedot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='info.css') }}">
</head>
<body>
  <!-- Headerin sisältö (eka osio sivusta) -->
  <header class="header-section">
    <div class="header-top">
      <img class="site-title" src="{{ url_for('static', filename='Kuvat/logoWhite.png') }}" alt="Logo valkoinen">
      <div class="avatar-dropdown">
        <button class="icon-button" aria-label="Menu">
          <img loading="lazy" src="{{ user_avatar_url }}" class="icon-image" alt="Avatar" />
        </button>
        <div class="dropdown-content">
          <a href="{{ url_for('student_info') }}">Profiili</a>
          <a href="{{ url_for('avatar') }}">Avatar</a>
          <a href="{{ url_for('logout') }}">Kirjaudu ulos</a>
        </div>
      </div>
    </div>
    <div class="header-bottom">
      <div class="nav-buttons">
        <a href="{{ url_for('frontPage') }}">
          <button class="coming-soon-btn">Etusivu</button>
        </a>
      </div>
    </div>
  </header>
  <main class="container">
    <section class="content">
      <div class="left-column">
        <div class="circle">
          <img src="{{ user_avatar_url }}" alt="User Avatar" style="width: 100%; height: 100%; border-radius: 50%;" />
        </div>
        <div class="rectangle">
          <div class="container-row" style="padding-left: 5%;">
            <table style="width:100%">
              <tr>
                <td class="infoTxt">Etunimi:</td>
                <td><div id="etunimi">{{ oppilas.etunimi }}</div></td>
              </tr>
              <tr>
                <td class="infoTxt">Sukunimi:</td>
                <td><div id="sukunimi">{{ oppilas.sukunimi }}</div></td>
              </tr>
              <tr>
                <td class="infoTxt">Syntymäpäivä:</td>
                <td><div id="syntymapaiva">{{ oppilas.syntymapaiva }}</div></td>
              </tr>
              <tr>
                <td class="infoTxt">Luokka:</td>
                <td><div id="luokka">{{ luokka_nimi }}</div></td>
              </tr>
            </table>
          </div>
        </div>
      </div>
      <div class="right-rectangle" style="max-height: 400px; overflow-y: auto; border: 1px solid #ccc;">
        <table id="pelitulokset-taulukko">
          <thead>
            <tr>
              <th>Pelitulos ID</th>
              <th>Peli ID</th>
              <th>Pisteet</th>
              <th>Kysymykset</th>
              <th>Oikeat Vastaukset</th>
              <th>Päivämäärä</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="6">Ladataan pelituloksia...</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>
  <script>
    // Funktio pelitulosten hakemiseksi
    function fetchStudentResults(oppilasID) {
      var tableBody = document.getElementById('pelitulokset-taulukko').getElementsByTagName('tbody')[0];
      tableBody.innerHTML = '<tr><td colspan="6">Ladataan pelituloksia...</td></tr>';

      // Oletetaan, että pelitulokset haetaan reitistä '/get_student_results'
      fetch(`/get_student_gameresult?oppilasID=${oppilasID}`)
        .then(response => response.json())
        .then(data => {
          tableBody.innerHTML = '';  // Tyhjennetään aiempi sisältö

          if (data.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="6">Ei pelituloksia.</td></tr>';
            return;
          }

          // Lisätään rivit pelituloksille
          data.forEach(function(result) {
            var row = tableBody.insertRow();
            row.innerHTML = `
              <td>${result.pelitulosID}</td>
              <td>${result.Pelit_peliID}</td>
              <td>${result.pisteet}</td>
              <td>${result.kysymys_maara}</td>
              <td>${result.oikeat_vastaukset}</td>
              <td>${result.pvm}</td>
            `;
          });
        })
        .catch(error => {
          console.error("Virhe pelitulosten lataamisessa:", error);
          tableBody.innerHTML = '<tr><td colspan="6">Virhe ladattaessa pelituloksia.</td></tr>';
        });
    }

    // Oletetaan, että oppilasID on saatavilla jollain tavalla (esim. Flaskin kontekstissa)
    // Jos oppilasID on tallennettu sessioon tai sitä voidaan käyttää dynaamisesti, niin käytä sitä täällä.
    const oppilasID = "{{ oppilas.id }}";  // Tämä muuttuja tulee Flaskista HTML:ään
    fetchStudentResults(oppilasID);  // Kutsu pelitulosten latausta
  </script>
</body>
</html>
